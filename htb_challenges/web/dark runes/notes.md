# Deserialization Attacks - Notes

To solve this challenge, we analyze the source code provided.

1. **Token Generation**:
   - The token is generated by signing a JSON file. The signature is created using the same secret when generating a new document.
   - The token sent is: `{"username":"user","id":1}` (in Base64) followed by its signature.

2. **Creating an Admin Token**:
   - Create a new document with the following JSON payload:
     ```json
     {"username":"admin","id":1}
     ```
   - The code will sign this payload, generating a valid token for the admin user.

3. **Submitting the Modified Token**:
   - Submit the modified token with the admin JSON payload and its signature.

4. **Retrieving the Flag via XSS**:
   - Create another document containing the following XSS payload to retrieve the flag: using CVE-2023-0835
     ```html
     &lt;img src=x onerror="xhr=new XMLHttpRequest;xhr.onload=function(){document.write(xhr.responseText)};xhr.open('GET','file:///flag.txt');xhr.send()"&gt;
     ```
   - Export the document to a PDF by accessing the following route:
     ```
     /document/export/:id
     ```

This process allows you to escalate privileges and retrieve the flag.